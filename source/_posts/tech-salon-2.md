---
title: 技术沙龙第二期
date: 2021-11-12
categories: 网络
---

王快乐：

好！我来分享一下 高可用的网络架构 吧

王快乐：

这个高可用的网络架构更偏向于基础设施，与我最近的工作内容相关。

王快乐：

希望能给应用层网络高可用带来启发吧。

王快乐：

所谓基础设施的高可用网络架构，是为了解决提升带宽、增加可靠性，先给大家分享一下基础设施高可用网络架构的拓扑图。

![](network.png)

王快乐：

这个架构，一会儿再解释。我先分享一些简单网络的知识，做个铺垫。

王快乐：

华为有个 eNSP 模拟器，它提供一些网络设备，可以让我们随意组合，来进行网络实验。

这个是我昨晚做实验的一个拓扑，用来测试 ACL 了。提升网络安全的。通过 ACL 来控制，哪些部门 的 哪些设备 能访问 哪些网络。

这是 eNSP 模拟器，挺有意思的。我总不能买一堆设备回来做实验。除了华为，华三和思科也提供自己的模拟器，意图都是相同的。

![](ensp.png)


王快乐：

我们常见的网络设备，一般有交换机、路由器、防火墙、无线设备（AP、AC），还有 WAF 这些设备就比较少见。

基础设施的高可用网络架构里面，常规配置是：交换机 比较多，相当多；路由器一般就两台；防火墙也两台；其他设备一边根据需求、成本各方面进行综合考虑是否采用

主要的还是交换机。

王快乐：

交换机一般分为两类，盒式交换机，框式交换机。

盒式交换机就是我们平时见到的那种，一个方形的盒子。

框式交换机式数据中心用的，挺大的，各部分都是模块化的。

王快乐：

这个是盒式交换机

![](switch.png)

王快乐：

这个是框式交换机，各个部分都是模块化的，坏了直接换。

说到这，有句话真的是，技术进步的厉害，思想进步的慢。与盒式交换机比，框式还是模块化思想，将各个部分模块化、易插拔，坏了直接换模块。

![](big-switch.png)


王快乐：

盒式交换机，小型园区网、企业网会使用。框式交换机，一般数据中心会使用。

王快乐：

路由器、防火墙、无线设备（AP、AC），这些就不介绍了，这些不是这次分享的重点。

王快乐：

然后，我们再看一下交换机角色。这里有用到了分层的思想。

交换机的角色，分为三类：接入层、汇聚层、核心层。

从拓扑图里看，最下面是接入层，最上面是核心层。

接入层交换机：就是我们平台连接 PC 的交换机，功能很简单。听名字也是，只能接入设备，没有其他功能了。

汇聚层交换机：就是将链路进行汇聚，负责网络层的二层数据转发，只涉及 MAC 地址。也就是同个网络数据的转发。可以直接理解成内网数据转发。

核心层交换机：就有点路由功能了，三层转发，会涉及一些 IP 网络。交换机也有路由功能的，只是做的比较简单。说是分层思想，但也不可能 100% 都分开，也很小的耦合和关联度。

![](network.png)


yzl：

ip网络是ip协议层的网络吗

王快乐：

我们再来看一下交换机和交换机、交换机和终端设备的连接方式。

交换机和终端设备：我们平时连的比较简单，直接 PC 连上就行了。服务器不是这个样子，公司内网的服务器有四个网口，需要连接两台交换机，提供冗余和带宽的。

交换机和交换机：那绝对是个“环路连接法”。从图上也能看出来，一台交换机，连了两台设备，两台设备又互联，就是个环路。

抽出来就是下图的一个简单拓扑。模拟器比较简单，Server 没有那么多网口。

![](topo.png)


王快乐：

环路的问题不用担心，有生成树协议，STP RSTP MSTP。

通过这些协议，交换机进行角色选举，切换端口状态。端口状态有的：AP DP BP RP EP 五种状态，这个无需深究。

端口角色确认之后，某些端口是阻塞的，无法转发数据，这样就自己破除环路了。

自动将环路剪裁成树形结构，所以叫生成树协议。


王快乐：

有人可能会问……其实没人问……为啥非要接个环路，再引入一个协议，不接成环路不就好了？

为了冗余，假如一条链路断了，我们还可以走另外一条。

![](rongyu.png)


Shawn：

条条大路通罗马

王快乐：

是的，就是这个样子。除了冗余外，还能增加内网带宽。

王快乐：

现在回到最开始的架构图

iStack，Intelligent Stack 是华为的叫法，思科也有类似的技术。虚拟交换机，将两个交换机合并成一个逻辑的交换机，在逻辑上是一台设备。iStack 是用盒式交换机的。

CSS CLuster Switch System，也是华为的叫法，也是将多台设备逻辑成一台设备。CSS 需要使用框式交换机实现。

Eth-Trunk：是链路聚合。两台交换机之间，连了很多线。但是，这些线是逻辑上的一根线，提成带宽，增加冗余。

STP：是生成树协议，防止线连多了以后，出现环路。

整个网络，通过设备的方式（双设备，成本高），并辅以软件实现（Eth-Trunk，成本低）来提高冗余、增强可靠性。

![](network.png)


王快乐：

网络是个基础设施，里面涉及了很多东西，但是这个不是这个分享想表达的。今天的分享想表达的是 技术千变万化，但是背后的思想是固定，我们可以把这些思想借用过来，并进行进一步的提升这些思想，而不仅局限于技术的提升。

王快乐：

好了，今天就分享这么多吧，谢谢大家聆听。[呲牙]

洁洁：

@王快乐 讲讲家用路由和企业路由的区别。

志伟：

最主要的区别就是贵[破涕为笑]

Rain：

实现可靠性的级别不同，企业级要求7x24工作强度不能异常，家用的可接受每日重启

王快乐：

绝大多数东西都是需求和业务驱动的，然后技术只是做个实现。

所以，两者的差别就是功能多少的差别。

家用路由器的需求就是上网就行了：
1）PPPoE 做个拨号，NAT 做个地址转换；
2）DHCP 自动分配地址，解决用户不会配置、配置麻烦的问题。
3）再就是无线功能
4）前三点足够了，其他的功能都是面向其他有特殊需求的用户的。
5）然后功能多了，再提高一下性能。

家用路由器以解决家庭上网需求为主。

企业路由器就不一样，那老复杂了：
1）首先就没有无线功能，路由器的核心是路由三层数据包。家用路由器里并不强调这点。
2）焦点还是企业需求：7x24、可用性、QoS、网络隔离、访问安全、外部接入。
